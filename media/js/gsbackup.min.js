$(document).ready(function(){$("input:submit, button").button();$(".panel-trigger").click(function(){var a=$(this);a.next(".panel").slideToggle("fast")});$("#form_install").submit(function(){$("input[type=submit]",this).attr("disabled","disabled")});$("select").change(function(){$(this).closest("li").find(".s3-options-panel").slideToggle("fast")});$("select").each(function(){if($(this).val()=="1"){$(this).next(".panel").css("display","block")}});$("input[type='checkbox'][value='all']").change(function(){var a=$(this).attr("name");var b=$(this).attr("checked");$(this).closest("form").find("input[name='"+a+"']").each(function(){if(b=="checked"&&!$(this).attr("checked")){$(this).attr("checked",b);$.uniform.update($(this))}else{if(!b&&$(this).attr("checked")=="checked"){$(this).removeAttr("checked");$.uniform.update($(this))}}})});$("input[type='checkbox'][value!='all']").change(function(){var b=$(this).attr("name");var a=$(this).closest("form").find("input[name='"+b+"'][value='all']");if(a.attr("checked")){a.removeAttr("checked");$.uniform.update(a)}});$(".download-button").click(function(a){a.preventDefault();window.location.href="download/"+$(this).attr("name")});$(".s3-upload-button").click(function(a){a.preventDefault();var b=$(this).attr("backup-id");submit_data="type=s3&id="+b;dialog_confirm("Upload to S3 now?")});$(".backup-button").click(function(b){var a=/backup-(\d+)/.exec($(this).attr("id"));submit_data="type=backup&id="+a[1];action="backup";dialog_confirm("Backup "+$(this).attr("name")+" now?")});$("form.confirm").submit(function(d){d.preventDefault();submit_data=$(this).serialize();var c=$(this).children("input[name='type']").val();var b=$(this).find("input[name='name']").val();var f=$(this).children("input[name='id']").val();var e="";var a=false;if(c=="mc"||c=="nc"||c=="otb"){if(b==""){e="You must enter a name.";a=true}else{if(/^[\W]/.test(b)){e="Name must start with a letter or number.";a=true}else{if(/[^a-zA-Z0-9\-_\. ]/.test(b)){e="Name can only contain letters, numbers, spaces, and these characters: ._-";a=true}}}if(!$(this).find(":checked").val()){if(a){e+="<br />"}e+="You must select at least one domain or database.";a=true}}if(c=="eb"){if(!$(this).find(":checked").val()){e="You must select at least one backup to delete.";a=true}}if(a){dialog_error(e);return false}if(c=="mc"||c=="nc"){e="Save "+b+"?"}else{if(c=="dc"){e="Delete selected configurations?"}else{if(c=="otb"){action="backup";e="Create backup?"}else{if(c=="settings"){e="Save settings?"}else{if(c=="eb"){e="Delete selected backups?"}}}}}dialog_confirm(e);return false})});var submit_data="";var action="";function do_confirm_action(){if(action=="backup"){set_waiting(true);dialog_wait("Please wait.  Backup in progress.");action==""}$.post("update.php",submit_data,function(a){res=$.parseJSON(a);if(res.debug&&typeof(console)!=="undefined"){console.log(res.debug)}if(!res.success){dialog_error(res.text)}else{dialog_results(res.text)}set_waiting(false)}),"json";return false}function set_waiting(a){var b="auto";if(a){b="progress"}$("#dialog").css("cursor",b);$(".ui-widget-overlay").css("cursor",b)}function dialog_confirm(b){var a=$("#dialog");a.dialog("destroy");$("#dialog-text").html(b);a.dialog({autoOpen:true,modal:true,dialogClass:"",title:"Confirm",resizable:false,draggable:false,buttons:{Ok:function(){do_confirm_action()},Cancel:function(){$(this).dialog("close")}}})}function dialog_results(b){var a=$("#dialog");a.dialog("destroy");$("#dialog-text").html(b);a.dialog({autoOpen:true,modal:true,dialogClass:"",title:"Success!",resizable:false,draggable:false,closeOnEscape:true,buttons:{Close:function(){$(this).dialog("close")}},close:function(c,d){location.reload()},})}function dialog_wait(b){var a=$("#dialog");a.dialog("close");a.dialog("destroy");$("#dialog-text").html(b);a.dialog({autoOpen:true,modal:true,dialogClass:"",title:"Working...",resizable:false,draggable:false,closeOnEscape:false,buttons:{},open:function(c,d){$(".ui-dialog-titlebar-close").hide()},close:function(c,d){alert("closed! wtf")},})}function dialog_error(b){var a=$("#dialog");a.dialog("destroy");$("#dialog-text").html(b);a.dialog({autoOpen:true,modal:true,dialogClass:"ui-state-error",title:"Error!",resizable:false,draggable:false,buttons:{Ok:function(){$(this).dialog("close")},}})};